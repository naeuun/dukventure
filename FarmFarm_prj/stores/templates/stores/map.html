{% extends "base.html" %}

{% block content %}
<h2>가게 지도</h2>
<div id="map" style="width:100%;height:500px;"></div>

{{ stores|json_script:"store-data" }}

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=99fb650695dceb9f3c38f165656fe2c8&libraries=services"></script>
<script>
var mapContainer = document.getElementById('map');
var mapOption = {
    center: new kakao.maps.LatLng(37.6509, 127.0164),
    level: 5
};
var map = new kakao.maps.Map(mapContainer, mapOption);

var stores = JSON.parse(document.getElementById('store-data').textContent);

stores.forEach(function(store) {
    var geocoder = new kakao.maps.services.Geocoder();
    geocoder.addressSearch(store.address, function(result, status) {
        if (status === kakao.maps.services.Status.OK) {
            var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
            var marker = new kakao.maps.Marker({
                map: map,
                position: coords
            });
            var infowindow = new kakao.maps.InfoWindow({
                content: '<div style="padding:5px; min-width:120px;"><b>' + store.name + '</b><br>판매자: ' + store.seller + '<br>' + store.address + '</div>'
            });
            kakao.maps.event.addListener(marker, 'click', function() {
                infowindow.open(map, marker);
            });
        }
    });
});
</script>
<script>
console.log("stores 데이터:", document.getElementById('store-data').textContent);
</script>
{% endblock %}
