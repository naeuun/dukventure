{% extends "base_2.html" %}

{% load static %}
{% block style %}
<link rel="stylesheet" href="{% static 'css/seller_onboardings/seller_onboarding_3.css' %}" />

{% endblock style %}
{% block script %}
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=99fb650695dceb9f3c38f165656fe2c8&libraries=services"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ì‚­ì œëœ ê¸°ì¡´ ì•„ì´í…œ IDë¥¼ ì €ì¥í•  íˆë“  í•„ë“œ ì»¨í…Œì´ë„ˆ
    const itemList = document.getElementById('itemList');
    const deletedItemsContainer = document.createElement('div');
    deletedItemsContainer.id = 'deletedItemsContainer';
    deletedItemsContainer.style.display = 'none';
    itemList.appendChild(deletedItemsContainer);

    // ì•„ì´í…œ ì œê±°
    function removeItem(btn) {
        const div = btn.closest('.item_detail_hugger');
        if (!div) return;

        // ê¸°ì¡´ ì•„ì´í…œì´ë©´ ì‚­ì œ ëª©ë¡ì— ì¶”ê°€
        const itemIdInput = div.querySelector('input[name^="item_id_"]');
        if (itemIdInput) {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'deleted_items';
            input.value = itemIdInput.value;
            deletedItemsContainer.appendChild(input);
        }

        div.remove();
    }
    window.removeItem = removeItem;

    // ì¶”ê°€ ë²„íŠ¼ í´ë¦­
    document.getElementById('addItemBtn').onclick = function() {
        const existingItems = document.querySelectorAll('#itemList .per_row .item_detail_hugger');
        const idx = existingItems.length;
        const div = document.createElement('div');
        div.className = 'item_detail_hugger';
        div.innerHTML = `
            <div>
                <input type="text" name="item_name_${idx}" id="item_name_${idx}" placeholder="í’ˆëª©ëª…">
                <input type="text" name="item_unit_${idx}" id="item_unit_${idx}" placeholder="ë‹¨ìœ„">
            </div>
            <div>
                <input type="number" name="item_price_${idx}" id="item_price_${idx}" placeholder="ê°€ê²©">
                <input type="text" name="item_desc_${idx}" id="item_desc_${idx}" placeholder="ì„¤ëª…">
            </div>
            <div>
                <input type="file" id="itemPhoto"  name="photo" accept="image/*" style="display: none;">
                <label for="itemPhoto">
                    <img src="{% static 'img/add_photo.png' %}" alt="upload" class="upload_icon_2" />
                </label>
                <button class="deleteitem" type="button" onclick="removeItem(this)">Ã—</button>
            </div>
        `;
        document.querySelector('#itemList .per_row').appendChild(div);
    };

    // ------------------------- ì§€ë„/ì£¼ì†Œ ê´€ë ¨ -------------------------
    const addressInput = document.getElementById('addressInput');
    const latitudeInput = document.getElementById('latitudeInput');
    const longitudeInput = document.getElementById('longitudeInput');
    const geocoder = new kakao.maps.services.Geocoder();
    const ps = new kakao.maps.services.Places();
    const searchModal = document.getElementById('searchModal');
    const searchResult = document.getElementById('searchResult');
    const closeSearchModal = document.getElementById('closeSearchModal');

    let map, marker;

    function updateCoordsFromAddress() {
        const address = addressInput.value.trim();
        if (!address) return;
        geocoder.addressSearch(address, function(result, status) {
            if (status === kakao.maps.services.Status.OK && result.length > 0) {
                const lat = result[0].y;
                const lng = result[0].x;
                latitudeInput.value = lat;
                longitudeInput.value = lng;
                setMarkerAndCenter(lat, lng);
            } else {
                latitudeInput.value = "";
                longitudeInput.value = "";
                alert("ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            }
        });
    }

    function initMap(lat, lng) {
    const center = new kakao.maps.LatLng(lat, lng);

    if (!map) map = new kakao.maps.Map(document.getElementById('mapContainer'), { center, level: 3 });
    else map.setCenter(center);

    // ì»¤ìŠ¤í…€ ì´ë¯¸ì§€
    const imageSrc = "{% static 'img/stores.png' %}";
    const imageSize = new kakao.maps.Size(20, 20);
    const imageOption = { offset: new kakao.maps.Point(10, 20) }; // ë§ˆì»¤ ì¤‘ì‹¬ ì¡°ì •
    const markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);

    if (!marker) {
        marker = new kakao.maps.Marker({
            position: center,
            map: map,
            image: markerImage
        });
    } else {
        marker.setPosition(center);
        marker.setImage(markerImage);
    }

    kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
        const latlng = mouseEvent.latLng;
        latitudeInput.value = latlng.getLat();
        longitudeInput.value = latlng.getLng();
        geocoder.coord2Address(latlng.getLng(), latlng.getLat(), function(result, status) {
            addressInput.value = (status === kakao.maps.services.Status.OK && result[0].address.address_name)
                ? result[0].address.address_name
                : "";
            setMarkerAndCenter(latlng.getLat(), latlng.getLng());
        });
    });
}


    function setMarkerAndCenter(lat, lng) {
    const loc = new kakao.maps.LatLng(lat, lng);
    
    // ì»¤ìŠ¤í…€ ì´ë¯¸ì§€ ìƒì„±
    const imageSrc = "{% static 'img/stores.png' %}"; // ì‚¬ìš©í•  ì´ë¯¸ì§€ ê²½ë¡œ
    const imageSize = new kakao.maps.Size(20, 20); // ë§ˆì»¤ ì´ë¯¸ì§€ í¬ê¸°
    const imageOption = { offset: new kakao.maps.Point(20, 50) }; // ë§ˆì»¤ ê¸°ì¤€ì  (ì´ë¯¸ì§€ ì•„ë˜ ì¤‘ì‹¬)
    const markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);

    if (!map) initMap(lat, lng);

    if (!marker) {
        marker = new kakao.maps.Marker({
            position: loc,
            map: map,
            image: markerImage // ì»¤ìŠ¤í…€ ì´ë¯¸ì§€ ì ìš©
        });
    } else {
        marker.setPosition(loc);
        marker.setImage(markerImage);
    }

    map.setCenter(loc);
}


    addressInput.addEventListener('blur', updateCoordsFromAddress);
    addressInput.addEventListener('keydown', function(e) { if (e.key==='Enter') { e.preventDefault(); updateCoordsFromAddress(); } });

    document.getElementById('mapBtn').onclick = function() {
        document.getElementById('mapModal').style.display='block';
        const lat = parseFloat(latitudeInput.value)||37.6509;
        const lng = parseFloat(longitudeInput.value)||127.0164;
        setTimeout(()=>{ initMap(lat,lng); },100);
    };
    document.getElementById('closeModal').onclick = function(){ document.getElementById('mapModal').style.display='none'; };

    document.getElementById('searchBtn').onclick = function() {
        const query = addressInput.value.trim();
        if (!query) return;
        ps.keywordSearch(query, function(data, status) {
            searchResult.innerHTML = '';
            if (status === kakao.maps.services.Status.OK) {
                data.forEach(place => {
                    const li = document.createElement('li');
                    li.textContent = place.place_name+' ('+place.address_name+')';
                    li.style.cursor='pointer';
                    li.style.padding='5px 0';
                    li.onclick = function() {
                        addressInput.value = place.address_name;
                        latitudeInput.value = place.y;
                        longitudeInput.value = place.x;
                        setMarkerAndCenter(place.y, place.x);
                        searchModal.style.display='none';
                    };
                    searchResult.appendChild(li);
                });
            } else searchResult.innerHTML='<li>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
            searchModal.style.display='block';
        });
    };
    closeSearchModal.onclick = function(){ searchModal.style.display='none'; };

    document.getElementById('storePhoto').addEventListener('change', function(e){
        const file = e.target.files[0];
        document.getElementById('storePhotoName').textContent = file?file.name:'ì„ íƒëœ íŒŒì¼ ì—†ìŒ';
    });

    // ------------------------- ìŒì„± ì¸ì‹ -------------------------
    const voiceBtn = document.getElementById('voiceBtn');
    const voiceStatus = document.getElementById('voiceStatus');
    let mediaRecorder = null, audioChunks=[], currentStream=null;

    voiceBtn.addEventListener('click', async () => {
    if (!navigator.mediaDevices?.getUserMedia) { 
        alert("ë¸Œë¼ìš°ì €ê°€ ìŒì„± ì…ë ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."); 
        return; 
    }

    // ë…¹ìŒ ì¤‘ì´ë©´ ì¤‘ì§€
    if (mediaRecorder?.state === "recording") {
        mediaRecorder.stop();
        currentStream?.getTracks().forEach(t => t.stop());
        currentStream = null;
        return;
    }

    try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        currentStream = stream;
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];

        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

        mediaRecorder.onstart = () => {
            voiceStatus.textContent = "ğŸ¤ ë…¹ìŒ ì¤‘...";
            voiceStatus.style.opacity = 1;
            textbox.style.opacity = 1;
            clearTimeout(hideTimeout);
        };

        mediaRecorder.onstop = async () => {
            currentStream?.getTracks().forEach(t => t.stop());
            currentStream = null;

            const audioBlob = new Blob(audioChunks);
            const reader = new FileReader();
            reader.readAsDataURL(audioBlob);
            reader.onloadend = async () => {
                const base64Audio = reader.result;
                voiceStatus.textContent = "â³ ì„œë²„ ì²˜ë¦¬ ì¤‘...";
                voiceStatus.style.opacity = 1;
                textbox.style.opacity = 1;
                isProcessing = true; // ì„œë²„ ì²˜ë¦¬ ì¤‘ ìƒíƒœ

                try {
                    const response = await fetch("{% url 'stores:voice_input' %}", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ audio: base64Audio, form_type: 'register' })
                    });
                    const data = await response.json();
                    if(!data.form_data){ 
                        voiceStatus.textContent="âš ï¸ ìŒì„± ì²˜ë¦¬ ì‹¤íŒ¨"; 
                        isProcessing = false;
                        return; 
                    }

                    const formData = data.form_data;

                    // ê° í•„ë“œ ì—…ë°ì´íŠ¸
                    ['name','address','contact','sale_days','sale_hours','payment_methods','description'].forEach(f=>{
                        if(formData[f]){
                            const el = document.getElementById(
                                f==='name'?'nameInput':
                                f==='address'?'addressInput':
                                f==='contact'?'contactInput':
                                f==='sale_days'?'saleDaysInput':
                                f==='sale_hours'?'saleHoursInput':
                                f==='payment_methods'?'paymentMethodsInput':
                                'descriptionInput'
                            );
                            if(el) el.value = formData[f];
                        }
                    });

                    // íŒë§¤ í’ˆëª©
                    if(formData.items?.length > 0){
                        const perRow = document.querySelector('#itemList .per_row');
                        perRow.querySelectorAll('div').forEach(div => div.remove());
                        formData.items.forEach((item, idx) => {
                            const div = document.createElement('div');
                            div.className = 'item_detail_hugger';
                            div.innerHTML = `
                            <div>
                                <input type="text" name="item_name_${idx}" placeholder="í’ˆëª©ëª…" value="${item.name||''}">
                                <input type="text" name="item_unit_${idx}" placeholder="ë‹¨ìœ„" value="${item.unit||''}">
                            </div>
                            <div>
                                <input type="number" name="item_price_${idx}" placeholder="ê°€ê²©" value="${item.price||''}">
                                <input type="text" name="item_desc_${idx}" placeholder="ì„¤ëª…" value="${item.description||''}">
                            </div>
                            <div>
                                <input id="itemPhoto_voiced" type="file" name="item_photo_${idx}" accept="image/*" style="display:none;">
                                        <label for="itemPhoto_voiced">
                                            <img src="{% static 'img/add_photo.png' %}" alt="upload" class="upload_icon_2" />
                                        </label>
                                <button type="button" class="deleteitem" onclick="removeItem(this)">Ã—</button>
                            </div>
                            `;
                            perRow.appendChild(div);
                        });
                    }

                    voiceStatus.textContent = "âœ… ìŒì„± ì…ë ¥ ì™„ë£Œ";
                } catch(err){ 
                    console.error(err); 
                    voiceStatus.textContent="âŒ ì„œë²„ ì˜¤ë¥˜"; 
                } finally {
                    isProcessing = false; // ì„œë²„ ì²˜ë¦¬ ë
                    hideElementsAfterDelay(3000); // ì²˜ë¦¬ ì™„ë£Œ í›„ 3ì´ˆ ë’¤ ìˆ¨ê¹€
                }
            };
        };

        mediaRecorder.start();
    } catch(err){ 
        console.error(err); 
        voiceStatus.textContent="âŒ ë§ˆì´í¬ ì ‘ê·¼ ê±°ë¶€ë¨"; 
    }
});
    

const textbox = document.querySelector('.textbox');


let hideTimeout = null;
let isProcessing = false;  

function hideElementsAfterDelay(delay=3000) {
    clearTimeout(hideTimeout);

    // ë…¹ìŒ ì¤‘ì´ë©´ ìˆ¨ê¸°ì§€ ì•ŠìŒ
    if(mediaRecorder?.state === "recording" || isProcessing) return;

    hideTimeout = setTimeout(() => {
        voiceStatus.style.opacity = 0;
        textbox.style.opacity = 0;
    }, delay);
}


// í˜ì´ì§€ ë¡œë“œ ì‹œ 3ì´ˆ í‘œì‹œ í›„ ìˆ¨ê¸°ê¸°
voiceStatus.style.opacity = 1;
textbox.style.opacity = 1;
hideElementsAfterDelay(3000);

// hover ì‹œ ë³´ì´ê²Œ
voiceBtn.addEventListener('mouseenter', () => {
    voiceStatus.style.opacity = 1;
    textbox.style.opacity = 1;
});
voiceBtn.addEventListener('mouseleave', () => {
    hideElementsAfterDelay(0); // hover ëë‚˜ë©´ ë°”ë¡œ ìˆ¨ê¹€
});

});
</script>

{% endblock script %}

{% block body %}
<div class="big_hugger">
    <div class="container_2">
        {% if mode == 'register' %}
        <div class="progress_bar">
            <div class="now_step" style="width: 270px;"></div>
        </div>
        {% endif %}
        <div class="content">
            <p class="bigger_content">
                <div class="textboxarea">
                    <img src="{% static 'img/textbox/side_vertical_text_box.png' %}" alt="ë§í’ì„ " class="brocoli_says">
                    <img src="{% static 'img/voice_brocoli.png' %}" alt="ë¸Œë¡œì½œë¦¬" class="brocoli_2">
                    <div class="text">ìŒì„±ë…¹ìŒ <span style="color:grey;">ë“±ë¡ì´ ê°€ëŠ¥í•´ìš”!</span></div>
                </div>
                <span class="title">{% if mode == 'edit' %}ê°€ê²Œ ì •ë³´ ìˆ˜ì •{% else %}ê°€ê²Œ ë“±ë¡{% endif %}</span>
                
<div class="maphugger">
<div id="mapModal">
    <div style="text-align:right; padding:5px;">
        <button id="closeModal">Ã—</button>
    </div>
    <div id="mapContainer"></div>
</div>
</div>
            </p>
            <div class="register_box">
            <div class="scrollable_container">
                <form method="post" enctype="multipart/form-data" id="storeForm">
                    {% csrf_token %}
                    <input type="hidden" id="latitudeInput" name="latitude" value="{{ form.latitude.value|default_if_none:'' }}">
                    <input type="hidden" id="longitudeInput" name="longitude" value="{{ form.longitude.value|default_if_none:'' }}">

                    <!-- 1. ê°€ê²Œ ì´ë¦„ -->
                    <div class="form_row">
                        <label for="nameInput">1. ê°€ê²Œ ì´ë¦„</label>
                        <input type="text" name="name" id="nameInput" value="{{ form.name.value|default_if_none:'' }}" placeholder="ì…ë ¥í•˜ì‹œì˜¤..." />
                    </div>

                    <!-- 2. ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸ -->
                    <div class="form_row">
                        <label for="businessNumberInput">2. ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸</label>
                        <input type="text" name="business_number" id="businessNumberInput" value="{{ request.user.seller.business_number }}" readonly placeholder="ì…ë ¥í•˜ì‹œì˜¤..." />
                    </div>

                    <!-- íŒë§¤ ì¥ì†Œ -->
                    <div class="form_row ">
                        <label for="addressInput">3. íŒë§¤ ì¥ì†Œ</label>
                        <div class="place">
                            <input type="text" id="addressInput" name="address"
                                value="{{ form.address.value|default_if_none:'' }}"
                                placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ê±°ë‚˜, ê²€ìƒ‰/ì§€ë„ì—ì„œ ì„ íƒí•˜ì„¸ìš”">
                            <button type="button" id="searchBtn">
                                <img src="{% static 'img/search.png' %}" alt="upload" class="search" />
                            </button>
                            <button type="button" id="mapBtn">ğŸ—º</button>

                            <!-- ê²€ìƒ‰ ê²°ê³¼ ëª¨ë‹¬ -->
                            <div id="searchModal" style="display:none; position:fixed; top:20%; left:30%; width:40%; background:#fff; z-index:2000; border:1px solid #ccc; box-shadow:0 2px 8px rgba(0,0,0,0.2);">
                                <div style="text-align:right; padding:5px;">
                                    <button id="closeSearchModal">ë‹«ê¸°</button>
                                </div>
                                <ul id="searchResult" style="list-style:none; padding:10px; margin:0; max-height:250px; overflow-y:auto;"></ul>
                            </div>
                        </div>
                    </div>


                        <!-- 4. íŒë§¤ í’ˆëª© -->
                        <div class="form_row" id="itemList">
                            <label for="">3. íŒë§¤ í’ˆëª©</label>
                            <div class="per_row">
                                {% if store and store.store_items.all %}
                                {% for store_item in store.store_items.all %}
                                <div class="item_detail_hugger existing_items">
                                    <input type="hidden" name="item_id_{{ forloop.counter0 }}" value="{{ store_item.id }}">

                                    <div>
                                        <input type="hidden" name="item_id_{{ forloop.counter0 }}" value="{{ store_item.id }}">
                                        <input type="text" name="item_name_{{ forloop.counter0 }}" id="item_name_{{ forloop.counter0 }}" value="{{ store_item.item.name }}" placeholder="í’ˆëª©ëª…">
                                        <input type="text" name="item_unit_{{ forloop.counter0 }}" id="item_unit_{{ forloop.counter0 }}" value="{{ store_item.unit }}" placeholder="ë‹¨ìœ„">
                                    </div>
                                    <div>
                                        <input type="number" name="item_price_{{ forloop.counter0 }}" id="item_price_{{ forloop.counter0 }}" value="{{ store_item.price }}" placeholder="ê°€ê²©">
                                        <input type="text" name="item_desc_{{ forloop.counter0 }}" id="item_desc_{{ forloop.counter0 }}" value="{{ store_item.description }}" placeholder="ì„¤ëª…">
                                    </div>
                                    <div>
                                        <input type="file" id="itemPhoto_{{ forloop.counter0 }}" name="item_photo_{{ forloop.counter0 }}" accept="image/*" style="display:none;">
                                        <label for="itemPhoto_{{ forloop.counter0 }}">
                                            <img src="{% static 'img/add_photo.png' %}" alt="upload" class="upload_icon_2" />
                                        </label>
                                        <button class="deleteitem" type="button" onclick="removeItem(this)">Ã—</button>
                                    </div>
                                </div>
                                {% endfor %}
                                {% else %}
                                <div class="item_detail_hugger">
                                    <div>
                                        <input type="text" name="item_name_0" id="item_name_0" placeholder="í’ˆëª©ëª…">
                                        <input type="text" name="item_unit_0" id="item_unit_0" placeholder="ë‹¨ìœ„">
                                    </div>
                                    <div>
                                        <input type="number" name="item_price_0" id="item_price_0" placeholder="ê°€ê²©">
                                        <input type="text" name="item_desc_0" id="item_desc_0" placeholder="ì„¤ëª…">
                                    </div>
                                    <div>
                                        <input type="file" id="itemPhoto_{{ forloop.counter0 }}" name="item_photo_{{ forloop.counter0 }}" accept="image/*" style="display:none;">
                                        <label for="itemPhoto_{{ forloop.counter0 }}">
                                            <img src="{% static 'img/add_photo.png' %}" alt="upload" class="upload_icon_2" />
                                        </label>
                                        <button class="deleteitem" type="button" onclick="removeItem(this)">Ã—</button>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        <button type="button" id="addItemBtn">+</button>                    
                        </div>
                    
                    <!-- 5. íŒë§¤ ìš”ì¼ -->
                    <div class="form_row">
                        <label for="field4">5. íŒë§¤ ìš”ì¼</label>
                        <input type="text"  name="sale_days" id="saleDaysInput" value="{{ form.sale_days.value|default_if_none:'' }}" placeholder="ì˜ˆ: ì›”,ìˆ˜,ê¸ˆ" />
                    </div>

                    <!-- 6. íŒë§¤ ì‹œê°„ëŒ€ -->
                    <div class="form_row">
                        <label for="saleHoursInput">6. íŒë§¤ ì‹œê°„ëŒ€</label>
                        <input type="text" name="sale_hours" id="saleHoursInput" value="{{ form.sale_hours.value|default_if_none:'' }}" placeholder="ì˜ˆ: 10:00~18:00" />
                    </div>

                    <!-- 7. ê²°ì œ ìˆ˜ë‹¨ -->
                    <div class="form_row">
                        <label for="paymentMethodsInput">7. ê²°ì œ ìˆ˜ë‹¨</label>
                        <input type="text" name="payment_methods" id="paymentMethodsInput" value="{{ form.payment_methods.value|default_if_none:'' }}" placeholder="ì˜ˆ: í˜„ê¸ˆ, ì¹´ë“œ" />
                    </div>

                    <!-- 8. íŒë§¤ì ì—°ë½ ìˆ˜ë‹¨ -->
                    <div class="form_row">
                        <label for="contactInput">8. íŒë§¤ì ì—°ë½ ìˆ˜ë‹¨</label>
                        <input  type="text" name="contact" id="contactInput" value="{{ form.contact.value|default_if_none:'' }}" placeholder="ì˜ˆ: 010-1234-5678" />
                    </div>

                    <!-- 9. ê°€ê²Œ ì‚¬ì§„ ì—…ë¡œë“œ -->
                    <div class="form_row photo_zone">
                        <label for="storePhoto">9. ê°€ê²Œ ì‚¬ì§„ ì—…ë¡œë“œ</label>
                        <div class="file_upload">
                            <input type="file" id="storePhoto" name="photo" style="display:none;">
                            <span id="storePhotoName">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
                            <label for="storePhoto">
                                <img src="{% static 'img/add_photo.png' %}" class="upload_icon"/>
                            </label>


                        </div>
                    </div>

                    <!-- 10. íŠ¹ì´ì‚¬í•­ ë˜ëŠ” íŒë§¤ ë©”ì‹œì§€ (ì„ íƒ) -->
                    <div class="form_row last">
                        <label for="descriptionInput">10. ê°€ê²Œì„¤ëª…</label>
                        <input type="text" name="description" id="descriptionInput" placeholder="ê°„ë‹¨í•œ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value={{ form.description.value|default_if_none:'' }}>
                    </div>

                    <div class="button_hugger">
            <button
            type="button"
            value="ìŒì„± ì¸ì‹ ë²„íŠ¼"
            class="voice_recognition_btn"
            id="voiceBtn"
            data-form-type="register"
            >
                <img src="{% static 'img/mic.png' %}" alt="ìŒì„± ì¸ì‹ ë²„íŠ¼">
            </button>
            <img src="{% static 'img/textbox/text_box.png' %}" alt="ë§í’ì„ " class="textbox">

            <span id="voiceStatus">
                ìŒì„±ë…¹ìŒ <span style="color:gray;">ë“±ë¡ì´ ê°€ëŠ¥í•´ìš”!</span>
            </span>
            <button
            type="submit"
            value="ê°€ê²Œ ì •ë³´ ë“±ë¡" 
            class="register_button"
            >
                {% if mode == 'edit' %}ìˆ˜ì • ì™„ë£Œ{% else %}ë“±ë¡í•˜ê¸°{% endif %}
            </button>
        </div>

                </form>
            </div>
        </div> 
        
        <div class="prev_page" onclick="history.back()">
            <img src="{% static 'img/left_back.png' %}" alt="ë’¤ë¡œ ê°€ê¸°">
        </div>
    </div>
</div>

<!-- ìŒì„± ì¸ì‹ ëª¨ë‹¬ -->
<div class="voice_modal hidden">
    <div class="voice_modal_overlay"></div>
    <div class="voice_modal_content">
        <button class="voice_modal_close">âœ•</button>
        <div class="text_box_area">
        <img src="{% static 'img/textbox/vertical_text_box.png' %}" alt="ë§í’ì„ " class="voice_modal_ann">
        <div class="ann_text">ë²„íŠ¼ì„ ëˆ„ë¥´ê³ , ë§í•˜ì„¸ìš”!</div>
        </div>
        <div class="voice_recognizing_btn">
        <img src="{% static 'img/mic_neon.png' %}" alt="ìŒì„± ì¸ì‹ ë²„íŠ¼" class="voice_modal_mic">
        </div>
    </div>
</div>

{% endblock body %}
