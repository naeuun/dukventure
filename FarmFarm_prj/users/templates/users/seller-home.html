{% extends "users/base_home.html" %}
{% load static %}
{% block role_content %}
<hr>
<h3>ê°€ê²Œ ì •ë³´ ğŸ‡</h3>
{% if store %}
    <div style="display:flex; align-items:center; gap:16px;">
        <div>
            <h4>{{ store.name }}</h4>
            <p><b>íŒë§¤ì :</b> {{ store.seller.name|default:store.seller.user.username }}</p>
            <a href="{% url 'stores:edit_store' store.id %}">ê°€ê²Œ ì •ë³´ ìˆ˜ì •</a>
        </div>
    </div>
    {% if store.photo %}
        <img src="{{ store.photo.url }}" alt="ê°€ê²Œ ì‚¬ì§„" style="width:300px; height:auto; display:block; margin-bottom:10px;">
    {% else %}
        <img src="{% static 'img/default_store.png' %}" alt="ê¸°ë³¸ ê°€ê²Œ ì‚¬ì§„" style="width:300px; height:auto; display:block; margin-bottom:10px;">
    {% endif %}
    {{ store.description }} <br>
    {% for store_item in store.store_items.all %}
        <div style="border:1px solid #eee; padding:16px; margin-bottom:16px; position:relative;">
            {% if store_item.photo %}
                <img src="{{ store_item.photo.url }}" alt="í’ˆëª© ì‚¬ì§„" style="width:200px; height:auto; display:block; margin-bottom:10px;">
            {% else %}
                <img src="{% static 'img/default_item.png' %}" alt="ê¸°ë³¸ í’ˆëª© ì‚¬ì§„" style="width:200px; height:auto; display:block; margin-bottom:10px;">
            {% endif %}
            <p><b>í’ˆëª©ëª…:</b> {{ store_item.item.name }}</p>
            <p><b>ìœ„ì¹˜:</b> {{ store.address }}</p>
            <p><b>íŒë§¤ ì‹œê°„:</b> {{ store.sale_hours }}</p>
            <p><b>ê°€ê²©:</b> {{ store_item.price }}ì›</p>
            <span>{{ store_item.description }}</span>
            <button type="button" class="edit-item-btn"
                data-id="{{ store_item.id }}"
                data-name="{{ store_item.item.name }}"
                data-price="{{ store_item.price }}"
                data-desc="{{ store_item.description }}"
                data-photo-name="{% if store_item.photo %}{{ store_item.photo.name }}{% else %}{% endif %}">
                âœï¸ í’ˆëª© ìˆ˜ì •
            </button>
        </div>
    {% empty %}
        <div>ë“±ë¡ëœ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    {% endfor %}
{% else %}
    <p>ì•„ì§ ë“±ë¡ëœ ê°€ê²Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    <button type="button"><a href="{% url 'stores:register' %}">ê°€ê²Œ ë“±ë¡í•˜ê¸°</a></button>
{% endif %}

<!-- í’ˆëª© ìˆ˜ì • ëª¨ë‹¬ -->
<div id="editItemModal" style="display:none; position:fixed; top:20%; left:35%; width:30%; background:#fff; z-index:3000; border:1px solid #ccc; box-shadow:0 2px 8px rgba(0,0,0,0.2); padding:20px;">
    <form id="editItemForm" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="item_id" id="modal_item_id">
        <label>í’ˆëª©ëª…</label>
        <input type="text" name="item_name" id="modal_item_name"><br>
        <label>ê°€ê²©</label>
        <input type="number" name="item_price" id="modal_item_price"><br>
        <label>ì„¤ëª…</label>
        <input type="text" name="item_desc" id="modal_item_desc"><br>
        <label>ì‚¬ì§„</label>
        <input type="file" name="item_photo" id="modal_item_photo" accept="image/*"><br>
        <button type="submit">ì €ì¥</button>
        <button type="button" id="closeEditItemModal">ë‹«ê¸°</button>
    </form>
</div>

<script>
document.querySelectorAll('.edit-item-btn').forEach(function(btn) {
    btn.onclick = function() {
        document.getElementById('editItemModal').style.display = 'block';
        document.getElementById('modal_item_id').value = btn.dataset.id;
        document.getElementById('modal_item_name').value = btn.dataset.name;
        document.getElementById('modal_item_price').value = btn.dataset.price;
        document.getElementById('modal_item_desc').value = btn.dataset.desc;
        document.getElementById('editItemForm').action = "/stores/edit_item/" + btn.dataset.id + "/"; // edit_item URLë¡œ ì§€ì •
        document.getElementById('modal_item_photo_name').textContent =
            btn.dataset.photoName ? btn.dataset.photoName : "";
    };
});
document.getElementById('closeEditItemModal').onclick = function() {
    document.getElementById('editItemModal').style.display = 'none';
};
</script>
{% endblock %}