{% extends "base.html" %}
{% block content %}
<h2>구매 내역 전체 보기</h2>
<div id="purchase-list">
    {% for r in past_reservations %}
        <div class="res-card" style="opacity: 0.9; margin-bottom: 18px;">
            <div class="res-card-image">
                {% with item=r.items.first %}
                    {% if item.image %}
                        <img width="120px" src="{{ item.image.url }}" alt="{{ item.item_name }}">
                    {% else %}
                        <img width="120px" src="https://placehold.co/120x80/2a2a2a/cccccc?text={{ item.item_name|default:'상품' }}" alt="{{ item.item_name }}">
                    {% endif %}
                {% endwith %}
            </div>
            <div class="res-card-info">
                <p><strong>{{ r.store.name }}</strong> - <strong>{{ r.store.seller.user.username }}</strong></p>
                <p><strong>품목:</strong>
                    {% for item in r.items.all %}
                        {{ item.item_name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>
                <p><strong>위치:</strong> {{ r.store.address }}</p>
                <p><strong>판매 시간:</strong> {{ r.store.sale_hours }}</p>
                <p><strong>가격:</strong> {{ r.total_price }}원</p>
                <p><strong>구매일:</strong> {{ r.created_at|date:"Y.m.d" }}</p>
            </div>
        </div>
    {% empty %}
        <p style="text-align:center; color: #aaa;">구매 내역이 없습니다.</p>
    {% endfor %}
</div>
{% endblock %}