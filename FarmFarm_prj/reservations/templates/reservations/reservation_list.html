{% extends "base.html" %}
{% block content %}
<style>
    .wrap { max-width: 900px; margin: 24px auto; padding: 0 16px; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .card { background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 14px; padding: 20px; margin-bottom: 16px; }
    .btn { background-color: #007bff; color: white; padding: 10px 15px; text-decoration: none; border-radius: 8px; }
</style>

<div class="wrap">
    <div class="header">
        <h2>내 예약 목록</h2>
        <!-- 'create' 대신 가게 목록 페이지로 연결합니다. -->
        <a href="{% url 'stores:list' %}" class="btn">새 예약하기</a>
    </div>

    {% for r in reservations %}
        <div class="card">
            <h4>{{ r.store.name }} <small>({{ r.get_status_display }})</small></h4>
            <p><strong>예약 코드:</strong> {{ r.reservation_code }}</p>
            <p><strong>요청 픽업 시간:</strong> {{ r.requested_pickup_at|date:"Y-m-d H:i" }}</p>
            <ul>
                {% for item in r.items.all %}
                    <li>{{ item.item_name }} ({{ item.quantity }}개) - {{ item.unit_price }}원</li>
                {% endfor %}
            </ul>
            <p><strong>총 금액: {{ r.total_price }}원</strong></p>

            {% if r.status == 'PICKED_UP' and not r.review %}
                <a href="{% url 'reviews:create' r.pk %}" class="btn" style="background-color: #28a745;">리뷰쓰기</a>
            {% endif %}
        </div>
    {% empty %}
        <p>예약 내역이 없습니다.</p>
    {% endfor %}
</div>
{% endblock %}